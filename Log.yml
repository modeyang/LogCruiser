---

chsize: 1000
interval: 3
input:
  - type: file
    path: test.log
    position: 0

filter:
  - type: split
    splitField: "|"
    removeFields: ["message"]
    fields:
      - from_host
      - idc
      - timestamp
      - status
      - request_time
  - type: convert
    fields:
      - field: status
        to: int
        removeIfFail: true
      - field: request_time
        to: float
        multiplier: 1000
        remove_if_fail: true
metrics:
  - metricTmpl: "access.qps/from_host={{.from_host}}"
    type: counter
    metricValue: 1
  - metricTmpl: "access.qps/idc={{.idc}}"
    type: counter
    metricValue: 1
  - metricTmpl: "error.qps/host=ALL"
    type: counter
    metricValue: 1
    filterTmpls:
      - "{{ if ge .status 499 }}true{{ end }}"
  - metricTmpl: "request.sum/from_host={{ .from_host }}"
    type: counter
    metricValue: "{{ .request_time }}"

output:
  - type: debug


